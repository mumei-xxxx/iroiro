---
title: "é­”ç†æ²™ã€ŒPureScript Jelly ã§ã€Reactãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ä¸‰ç›®ä¸¦ã¹ã®ã€Šç´”ç²‹é–¢æ•°å‹ï¼å‹å®‰å…¨ã€‹ç‰ˆã‚’ä½œã‚‹ãœã€â‘ "
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["PureScript"]
published: false
---

> **Moggi**ã¯ã€è¨ˆç®—åŠ¹æœã‚’å«ã‚“ã ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’**Kleisli**åœã®å°„ã¨ã¿ãªã™ã“ã¨ã«ã‚ˆã£ã¦ã€åœè«–çš„ã«ç‰©äº‹ã‚’ã†ã¾ãå–ã‚Šæ‰±ã†æ–¹æ³•ã‚’æå”±ã—ãŸã€‚
> è¨ˆç®—åŠ¹æœã‚’ãƒ¢ãƒŠãƒ‰ã«ã‚ˆã£ã¦æ‰ãˆã‚‹ã¨ã€ãƒ¢ãƒŠãƒ‰ã«ãŠã‘ã‚‹è‡ªç„¶å¤‰æ›$Î¼$ãŒã€Œåˆ†å²ã‚’ã†ã¾ãã¾ã¨ã‚ã‚‹ã€é‡è¦ãªåƒãã‚’ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚
>
> ã€åœè«–ã®é“æ¡ˆå†… ~çŸ¢å°ã§ãˆãŒãæ•°å­¦ã®ä¸–ç•Œ~ã€[^1]


éœŠå¤¢ã€ŒPureScript Advent Calendar 2022ã€‚24æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚ã€

https://qiita.com/advent-calendar/2022/purescript

## å®Œæˆã—ãŸã‚‚ã®

https://github.com/mumei-xxxx/purescript-sanmoku-dev0/tree/main/jelly-tic-tac-toe-without-timemachine

![tic-tac-toe](/images/purescript-jelly-tic-tac-toe-01/tic-tac-toe.gif)

## æ¦‚ç•¥

é­”ç†æ²™ã€ŒReactã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«ä¸‰ç›®ä¸¦ã¹ãŒã‚ã‚‹ã€‚ã€

https://ja.reactjs.org/tutorial/tutorial.html

@[codepen](https://codepen.io/gaearon/pen/LyyXgK?editors=0010)

éœŠå¤¢ã€Œä¸‰ç›®ãªã‚‰ã¹ã£ã¦ã€ä½•ï¼Ÿã€
é­”ç†æ²™ã€Œä¸‰ç›®ãªã‚‰ã¹ã¨ã¯ã€ãƒãƒ«ãƒãƒ„ã‚²ãƒ¼ãƒ ã ã€‚ä¸€æ‰‹ã”ã¨ã«äº¤äº’ã«å‡ç›®ã‚’â—‹ã‹Ã—ã§åŸ‹ã‚ã¦ã„ã£ã¦ã€ç¸¦ã‹æ¨ªã‹æ–œã‚ä¸€åˆ—ã«ãªã£ãŸã‚‚ã®ãŒå‹ã¡ãªã‚“ã ãœã€‚è‹±èªã§tic-tac-toeã¨ã„ã†ã€‚ã€
éœŠå¤¢ã€Œãªã‚‹ã»ã©ã­ã€‚ã€
é­”ç†æ²™ã€Œã“ã‚Œã‚’ä»Šå›ã¯ã€PureScript ã§ä½œã‚ã†ã¨æ€ã†ã€‚ã€
éœŠå¤¢ã€Œãªã‚“ã§ã€PureScript ã§ä½œã‚‹ã®ï¼Ÿã€
é­”ç†æ²™ã€Œæœ¬å½“ã«è‡ªåˆ†ã®çœŸã£æ­£ç›´ãªã“ã¨ã‚’è¨€ãˆã°ã€ãªã‚“ã¨ãªãã„ã„æ„Ÿã˜ã ã‹ã‚‰ã ã€‚ã€
éœŠå¤¢ã€Œãªã‚“ã¨ãªãã„ã„æ„Ÿã˜ã€
é­”ç†æ²™ã€Œç´”ç²‹é–¢æ•°å‹è¨€èªã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ä½œã‚‹ã¨ã„ã†ã®ã¯é¢ç™½ã„ãƒ†ãƒ¼ãƒã ã¨æ€ã†ãœã€‚ã€
é­”ç†æ²™ã€Œç´ æœ´ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ•°å­¦çš„ã€åœè«–çš„ãªæ„å‘³ãŒã‚ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œä¾‹ãˆã°ã€doæ§‹æ–‡ã®ãªã‹ã®`pure`ã€‚ã€
é­”ç†æ²™ã€Œã¤ã¾ã‚Šã€ãƒ¢ãƒŠãƒ‰ã®`pure`ã¯ã€å‹ `a` ã‚’å—ã‘å–ã£ã¦ å‹ `m a` ã‚’è¿”ã™ã‚ã‘ã ãŒã€‚ã€
é­”ç†æ²™ã€Œã“ã‚Œã¯ã€æ’ç­‰é–¢æ‰‹ã‹ã‚‰ `m` ã¸ã®è‡ªç„¶å¤‰æ›ã ãªã€‚ã€
é­”ç†æ²™ã€Œåœè«–ã®å‰µå§‹è€…ã®ãƒãƒƒã‚¯ãƒ¬ãƒ¼ãƒ³ã¯ã€æ¬¡ã®ã‚ˆã†ã«è¨€ã£ã¦ã„ã‚‹ã€‚ã€

> é–¢æ‰‹ã‚’ç ”ç©¶ã™ã‚‹ãŸã‚ã«åœã‚’è€ƒãˆå‡ºã—ãŸã®ã§ã¯ãªã„ã€‚
> è‡ªç„¶å¤‰æ›ã‚’ç ”ç©¶ã™ã‚‹ãŸã‚ã ã£ãŸã®ã ã€‚[^2]

é­”ç†æ²™ã€Œè‡ªç„¶å¤‰æ›ã¨ã„ã†æ¦‚å¿µã¯ã€åœè«–ã§ã¯ã˜ã‚ã¦å³å¯†ãªå®šç¾©ãŒä¸ãˆã‚‰ã‚ŒãŸã€‚ã€
é­”ç†æ²™ã€Œãã®è‡ªç„¶å¤‰æ›ã‚’ã€ä»Šã€äººé¡ã¯ã€`pure` ã®ã‚ˆã†ãªå½¢ã§åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚ã‘ã ã€‚ã€
é­”ç†æ²™ã€Œãã—ã¦ã€`Maybe` ã‚„ãƒªã‚¹ãƒˆã®ã‚ˆã†ãªä¸€è¦‹å˜ç´”ãªæ§‹é€ ã«ã€ãƒ¢ãƒŠãƒ‰ã€è‡ªç„¶å¤‰æ›ãŒæ½œã‚“ã§ã„ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œè¦‹æ–¹ã‚’å¤‰ãˆã‚Œã°ã€ã“ã‚Œã¯éå¸¸ã«é¢ç™½ã„ã“ã¨ã ã€‚ã€
é­”ç†æ²™ã€Œå¤šåˆ†ã€ã‚¯ãƒ©ã‚¤ã‚¹ãƒªåœã¨ã‹ãƒ¢ãƒŠãƒ‰æ§‹é€ ã¨ã„ã†ã®ã¯ã€ä¸–ç•Œã«ã‚ã‚Šãµã‚Œã¦ã„ã‚‹ã®ã ã¨æ€ã†ã€‚ãã‚Œã‚’åˆ©ç”¨ã—ãªã„ã ã‘ã§ã€‚ã€
é­”ç†æ²™ã€ŒHaskell / PureScriptã¨ã„ã£ãŸé“å…·ã‚’ä½¿ã†ã“ã¨ã§ã€ä¸–ç•Œã«éš ã•ã‚ŒãŸæ§‹é€ ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚ã€
é­”ç†æ²™ã€Œã“ã†ã„ã£ãŸæ•°å­¦çš„ãªé“å…·ã‚’ä½¿ã£ã¦çµ„ã¿ç«‹ã¦ã‚‰ã‚ŒãŸä¸–ç•Œã§ã€ã©ã†ã„ã†æ™¯è‰²ãŒè¦‹ãˆã¦ãã‚‹ã‹ã€‚ã€
é­”ç†æ²™ã€Œã“ã‚Œã¯ã€ã¨ã¦ã‚‚èˆˆå‘³æ·±ã„ã¨æ€ã†ãœã€‚ã€

éœŠå¤¢ã€Œãªã‚‹ã»ã©ã­ã€‚ãã‚Œã§ã€ä»Šå›ã¯ã€ã©ã‚“ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã†ã®ï¼Ÿã€
é­”ç†æ²™ã€ŒPureScript ã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã„ãˆã°ã€Halogen ãŒæœ‰åã ã€‚ã—ã‹ã—ã€ä»Šå›ã¯ã€Zennã§ã‚‚è¨˜äº‹ã‚’å…¬é–‹ã•ã‚Œã¦ã„ãŸã‚†ããã‚‰ã’ã•ã‚“ãŒä½œã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚‹ã€‚PureScript Jelly ã‚’ä½¿ã†ãœã€‚ã€

https://jelly.yukikurage.net/

éœŠå¤¢ã€Œãªã‚“ã§ Halogen ã¯ä½¿ã‚ãªã„ã®ï¼Ÿã€
é­”ç†æ²™ã€ŒHalogen ã¯å˜ç´”ã«è¤‡é›‘ã§ã€æŒ«æŠ˜ã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã¨æ€ã£ãŸãœã€‚ã€
éœŠå¤¢ã€Œã€å˜ç´”ã«è¤‡é›‘ã€ã­ã€‚ã€
é­”ç†æ²™ã€Œã¾ãŸã€PureScript Jelly ã¯ã€SolidJS ã‚’æ„è­˜ã—ã¦ã„ãŸã‚Šã€å‰²ã¨Reactãƒ©ã‚¤ã‚¯ã«æ›¸ã‘ã‚‹ã®ã§ã¯ã¨æ€ã£ãŸã‹ã‚‰ã ãœã€‚ã€
éœŠå¤¢ã€Œãªã‚‹ã»ã©ã­ã€‚ã€
é­”ç†æ²™ã€Œã¾ãŸã€Reactã®ä¸‰ç›®ãªã‚‰ã¹ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã€ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³æ©Ÿèƒ½ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã€‚ç«¯çš„ã«è¨€ã†ã¨ã€ã‚²ãƒ¼ãƒ å±¥æ­´æ©Ÿèƒ½ã ã€‚ã€
é­”ç†æ²™ã€Œã—ã‹ã—ã€ã“ã‚Œã‚’å…¥ã‚Œã‚‹ã¨ã€ã‚„ã‚„ãƒ­ã‚¸ãƒƒã‚¯ãŒè¾¼ã¿å…¥ã£ã¦ã€è¦‹ã›ãŸã„ã€PureScript ã‚„ Jelly ã®éƒ¨åˆ†ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«è¦‹ã‚Œã‚‰ã‚Œãªããªã‚‹ã€‚ã€
é­”ç†æ²™ã€Œã ã‹ã‚‰ã€ä»Šå›ã¯ã€ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³æ©Ÿèƒ½ã‚’ã®ãã„ãŸã€ç´”ç²‹ãªä¸‰ç›®ãªã‚‰ã¹ã®éƒ¨åˆ†ã‚’å®Ÿè£…ã—ã¦ã„ããœã€‚ã€
éœŠå¤¢ã€Œäº†è§£ã—ãŸã€‚ã€

> ä»®æƒ³ DOM ã‚’ä½¿ã‚ãªã„ Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ 'Jelly' ã‚’ä½œã£ãŸ in PureScript

https://zenn.dev/yukikurage/articles/4735819c3b421b

## ç’°å¢ƒ/ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

é­”ç†æ²™ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã ã€‚ã€
é­”ç†æ²™ã€ŒJelly ã¯ç¾åœ¨ã€çµ¶è³›ç™ºå±•ä¸­ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã ã€‚ä»Šå¾Œã€ç ´å£Šçš„å¤‰æ›´ã§ã€ã“ã®è¨˜äº‹ã«æ›¸ã„ã¦ã‚ã‚‹ã“ã¨ãŒã€å¤ããªã‚‹å¯èƒ½æ€§ã¯äº†æ‰¿ã—ã¦ãŠã„ã¦æ¬²ã—ã„ãœã€‚ã€

Windows Home 11 / WSL / Ubuntu 20.04
Node.js 18.12.1
npm 8.19.2
PureScript 0.15.6
PureScript Jelly 0.8.1
PureScript Jelly Signal 0.3.0

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

é­”ç†æ²™ã€Œã“ã‚ŒãŒä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã ã€‚ã€
é­”ç†æ²™ã€Œ`src` é…ä¸‹ã§é–‹ç™ºã—ã¦ã€ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸã‚‚ã®ãŒã€`public` é…ä¸‹ã«æ ¼ç´ã•ã‚Œã‚‹ãœã€‚ã€

```
.
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ packages.dhall
â”œâ”€â”€ public
â”‚Â Â  â”œâ”€â”€ index.css.map
â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”œâ”€â”€ style.css
â”‚Â Â  â””â”€â”€ style.css.map
â”œâ”€â”€ README.md
â”œâ”€â”€ spago.dhall
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ Components
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Board.purs
â”‚Â Â  â”‚Â Â  â””â”€â”€ Square.purs
â”‚Â Â  â”œâ”€â”€ Main.purs
â”‚Â Â  â”œâ”€â”€ style.scss
â”‚Â Â  â””â”€â”€ UseCases
â”‚Â Â      â””â”€â”€ calculateWinner.purs
â””â”€â”€ test
    â””â”€â”€ Main.purs
```

## ç’°å¢ƒæ§‹ç¯‰ã«ã¤ã„ã¦

é­”ç†æ²™ã€Œç’°å¢ƒæ§‹ç¯‰ã«é–¢ã—ã¦ã¯ã€PureScript Advent Calendarã€‚ 2022 1æ—¥ç›®ã®ã‚†ããã‚‰ã’ã•ã‚“ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã‚‚ã‚‰ã£ãŸãœã€‚ã€

> PureScript + Halogen + Tailwind ã§ Web ãƒ•ãƒ­ãƒ³ãƒˆé–‹ç™ºç’°å¢ƒæ§‹ç¯‰ (in VSCode)

https://qiita.com/yukikurage_2019/items/a2c7b0d1d2c34aee120c


é­”ç†æ²™ã€Œé•ã„ã¯ã€Tailwind ã§ã¯ãªãã€Sassã‚’ä½¿ã£ã¦ã„ã‚‹ã“ã¨ã ãœã€‚ã€

```json:package.json
"scripts": {
    "install": "npx spago install",
    "bundle:script": "npx spago bundle-app -t ./public/index.js -y",
    "bundle:scss": "sass --error-css --style=compressed ./src/style.scss ./public/style.css",
    "bundle": "run-s bundle:*",
    "watch:script": "npx spago bundle-app -t ./public/index.js -w",
    "watch:scss": "sass --watch --error-css ./src/style.scss ./public/style.css",
    "watch:server": "npx live-server ./public",
    "watch": "run-p watch:*"
},
```

## calculateWinner å‹è€…åˆ¤å®š

é­”ç†æ²™ã€Œã¾ãšã€ã“ã®è¨˜äº‹ã§ã¯ã€`calculateWinner` é–¢æ•°ã«ã¤ã„ã¦è§£èª¬ã™ã‚‹ãœã€‚ã€
é­”ç†æ²™ã€Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¤ã„ã¦ã¯ã€æ¬¡ã®è¨˜äº‹ã§è§£èª¬ã™ã‚‹ãœã€‚ã€
éœŠå¤¢ã€Œäº†è§£ã—ãŸã€‚ã€
é­”ç†æ²™ã€Œã¨ã‚Šã‚ãˆãšã€ä»¥å‰ã€TypeScript ã§ä½œã£ãŸã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã‹ã‚‰ã€ãã‚Œã‚’ã¿ã‚ˆã†ã€‚ã€
é­”ç†æ²™ã€ŒTypeScriptã§ä½œã£ãŸã‚³ãƒ¼ãƒ‰ã®è©³ç´°ã«ã¤ã„ã¦ã¯ä»¥å‰æ›¸ã„ãŸä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦æ¬²ã—ã„ã€‚ã€

> Next.js + TypeScript + Recoil + Herpç¤¾ESLint Config ã§Reactãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ä½œã‚‹ã€‚

https://zenn.dev/purenium/articles/nextjs-recoil-tic-tac-toe


```ts:src/useCases/calculateWinner.ts
/**
 * @description [null, null, null, null, null, null, 'X', null, 'O']ã®ã‚ˆã†ãªé…åˆ—
 */
type SquareValueType = "X" | "O" | null
type BoardArrType = SquareValueType[]

/**
 * @description å‹è€…ã‚’åˆ¤å®šã™ã‚‹ã€‚
 */
export const calculateWinner = (squares: BoardArrType): SquareValueType => {
  const lines = [
    [0, 1, 2],
    [3, 4, 5],
    [6, 7, 8],
    [0, 3, 6],
    [1, 4, 7],
    [2, 5, 8],
    [0, 4, 8],
    [2, 4, 6]
  ]

  for (const line of lines) {
    const [a, b, c] = line
    // ç¸¦ã€æ¨ªã€å¯¾è§’ç·š ã§3ã¤Xã‚ã‚‹ã„ã¯ã€OãŒé€£ç¶šã™ã‚Œã°ã€é€£ç¶šã—ãŸvalueã‚’è¿”ã™ã€‚
    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
      return squares[a]
    }
  }
  return null
}

```

é­”ç†æ²™ã€Œã“ã“ã§ã€`calculateWinner` ã®æ›¸ãæ›ãˆã ãŒã€ã¾ãšã€`for`æ–‡ã®ãªã‹ã§ã€å‹è€…ãŒã‚ã‚Œã°ã€ãã‚Œã‚’è¿”ã™ã€‚ã€
é­”ç†æ²™ã€Œãã‚Œä»¥å¤–ã ã¨ `null` ã‚’è¿”ã™ã€‚ã€
é­”ç†æ²™ã€Œã“ã‚Œã‚’PureScriptã§æ›¸ãæ›ãˆã‚‹ã®ã ãŒã€ã†ã¾ãã„ã‹ãªã‹ã£ãŸã€‚ã€
é­”ç†æ²™ã€Œã ã‹ã‚‰ã€PureScript ã®Discordã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§è³ªå•ã—ãŸã®ã ãŒã€ãã“ã§ã‚†ããã‚‰ã’ã•ã‚“ã«æ•™ãˆã‚‚ã‚‰ã£ã¦ãªã‚“ã¨ã‹ã„ã‘ãŸã®ã ãœã€‚ã€
éœŠå¤¢ã€Œã‚†ããã‚‰ã’ã•ã‚“ã‚ã‚ŠãŒã¨ã†ã€‚ã€

https://zenn.dev/yukikurage/articles/482a8647421fd5

é­”ç†æ²™ã€Œãã“ã§3ãƒ‘ã‚¿ãƒ¼ãƒ³ãã‚‰ã„æ•™ãˆã¦ã„ãŸã ã„ãŸã‹ã‚‰ãã‚Œã‚’ç´¹ä»‹ã™ã‚‹ãœã€‚ã€
é­”ç†æ²™ã€Œã“ã‚Œç”¨ã«åˆ¥ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ãŸã‹ã‚‰è¦‹ã¦ã»ã—ã„ã€‚ã€

https://github.com/mumei-xxxx/purescript-sanmoku-dev0/tree/main/purescript-calculatewinner-examples

```purs:src/Main.purs
module Main where

import Prelude (class Eq, class Ord, class Show, bind, discard, pure, ($), (==), join)
import Control.Alternative (guard)
import Data.Array (all, head, (!!), find)
import Data.Generic.Rep (class Generic)
import Data.Maybe (Maybe(..), isJust)
import Data.Show.Generic (genericShow)

lines :: Array (Array Int)
lines =
  [ [ 0, 1, 2 ]
  , [ 3, 4, 5 ]
  , [ 6, 7, 8 ]
  , [ 0, 3, 6 ]
  , [ 1, 4, 7 ]
  , [ 2, 5, 8 ]
  , [ 0, 4, 8 ]
  , [ 2, 4, 6 ]
  ]

data SquareValueType = X | O

derive instance Eq SquareValueType
derive instance Ord SquareValueType
derive instance Generic SquareValueType _

instance Show SquareValueType where
  show = genericShow

type Board = Array (Maybe SquareValueType)

{-
  https://pursuit.purescript.org/packages/purescript-arrays/7.1.0/docs/Data.Array#v:all
-}

{-
  find https://pursuit.purescript.org/packages/purescript-arrays/7.1.0/docs/Data.Array#v:find
  isJust
  https://pursuit.purescript.org/packages/purescript-maybe/6.0.0/docs/Data.Maybe#v:isJust
-}


calculateWinner1 :: Board -> Maybe SquareValueType
calculateWinner1 boardArr =
  let
    -- | ã‚ã‚‹ Line ãŒåŒã˜ SquareValueType ã§åŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹
    isLineMatch :: Array Int -> SquareValueType -> Boolean
    isLineMatch line squareValue = all (\i -> boardArr !! i == Just (Just squareValue)) line

    -- | ã™ã¹ã¦ã® Line, SquareValueType ã®çµ„ã¿åˆã‚ã›ã«ã¤ã„ã¦ isLineMatch ã‚’è©•ä¾¡ã™ã‚‹
    checked :: Array (Maybe SquareValueType)
    checked = do
      line <- lines
      squareValue <- [ X, O ]
      pure
        if isLineMatch line squareValue then
          Just squareValue
        else
          Nothing
  in
    -- | checked ã®ä¸­ã§ä¸€ç•ªæœ€åˆã« Just ãŒå‡ºã¦ããŸã‚‚ã®ã‚’è¿”ã™
    -- | find ã§å¸°ã£ã¦ãã‚‹ã®ã¯ Maybe (Maybe SquareValueType) ãªã®ã§ã€join ã§ä¸€ã¤ unwrap ã™ã‚‹
    join $ find isJust checked


calculateWinner2 :: Board -> Maybe SquareValueType
calculateWinner2 boardArr =
  let
    -- | ã‚ã‚‹ Line ãŒåŒã˜ SquareValueType ã§åŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹
    isLineMatch :: Array Int -> SquareValueType -> Boolean
    isLineMatch line squareValue = all (\i -> boardArr !! i == Just (Just squareValue)) line

    -- | ã™ã¹ã¦ã® Line, SquareValueType ã®çµ„ã¿åˆã‚ã›ã«ã¤ã„ã¦ isLineMatch ã‚’è©•ä¾¡ã™ã‚‹
    -- | false ãªã‚‰ãã‚Œã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
    checked :: Array SquareValueType
    checked = do
      line <- lines
      squareValue <- [ X, O ]
      guard $ isLineMatch line squareValue
      pure squareValue
  in
    head checked

{-
  [X, O, Nothing, X, O, O, X, O, O]
  [Just X, Just O, Nothing, Just X, Just O, Just O, Just X, Just O, Just O]

  calculateWinner $ map Just [X, O, X, X, O, O, X, O, O]
(Just X)
-}
calculateWinner :: Board -> Maybe SquareValueType
calculateWinner boardArr = head do
  line <- lines
  squareValue <- [ X, O ]
  guard $ all (\i -> boardArr !! i == Just (Just squareValue)) line
  pure squareValue

```

é­”ç†æ²™ã€Œã¾ãšã€ä»¥ä¸‹ã®å‹ã‹ã‚‰èª¬æ˜ã—ã¦ã„ãã€‚ã€

```purs
data SquareValueType = X | O
```

é­”ç†æ²™ã€Œã“ã‚ŒãŒã€å‡ç›®ã®å€¤ã‚’è¡¨ã™å‹ã ã€‚è¦ã™ã‚‹ã«ãƒãƒ«ãƒãƒ„ã‚²ãƒ¼ãƒ ã ã‹ã‚‰ã€`X` ã‹ `O`ã‹ã¨ã„ã†ã“ã¨ã ã€‚ã€
éœŠå¤¢ã€Œãªã‚‹ã»ã©ã­ã€‚ã€
é­”ç†æ²™ã€ŒãŸã ã€PureScript ã«ã¯ã€`null` ãŒãªã„ã€‚ã ã‹ã‚‰ã€`X` ã‹ `O` ã‹ `Nothing` ã‹ã® Maybeå€¤ã®é…åˆ—ã§å€¤ã‚’è€ƒãˆã¦ã„ãã“ã¨ã«ã™ã‚‹ã€‚ã¤ã¾ã‚Šã€ã€

```purs
type Board = Array (Maybe SquareValueType)
```

é­”ç†æ²™ã€Œã¨ã„ã†ã“ã¨ã ã€‚ã€

## ãƒ‘ã‚¿ãƒ¼ãƒ³â‘  let-inå¼ ã¨ ifå¼ã€‚

```purs
calculateWinner1 :: Board -> Maybe SquareValueType
calculateWinner1 boardArr =
  let
    -- | ã‚ã‚‹ Line ãŒåŒã˜ SquareValueType ã§åŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹
    isLineMatch :: Array Int -> SquareValueType -> Boolean
    isLineMatch line squareValue = all (\i -> boardArr !! i == Just (Just squareValue)) line

    -- | ã™ã¹ã¦ã® Line, SquareValueType ã®çµ„ã¿åˆã‚ã›ã«ã¤ã„ã¦ isLineMatch ã‚’è©•ä¾¡ã™ã‚‹
    checked :: Array (Maybe SquareValueType)
    checked = do
      line <- lines
      squareValue <- [ X, O ]
      pure
        if isLineMatch line squareValue then
          Just squareValue
        else
          Nothing
  in
    -- | checked ã®ä¸­ã§ä¸€ç•ªæœ€åˆã« Just ãŒå‡ºã¦ããŸã‚‚ã®ã‚’è¿”ã™
    -- | find ã§å¸°ã£ã¦ãã‚‹ã®ã¯ Maybe (Maybe SquareValueType) ãªã®ã§ã€join ã§ä¸€ã¤ unwrap ã™ã‚‹
    join $ find isJust checked
```

é­”ç†æ²™ã€Œã¾ãšã€`calculateWinner1`ã‹ã‚‰è¦‹ã¦ã„ãã€‚ã€
é­”ç†æ²™ã€Œ`let~in`å¼ã¨`if`å¼ã‚’ä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã ã€‚ã€

```purs
-- | ã‚ã‚‹ Line ãŒåŒã˜ SquareValueType ã§åŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹
isLineMatch :: Array Int -> SquareValueType -> Boolean
isLineMatch line squareValue = all (\i -> boardArr !! i == Just (Just squareValue)) line
```

é­”ç†æ²™ã€Œ`isLineMatch` ã¯ã²ã¨ã¤ã®åˆ—ã«ã¤ã„ã¦ã€åŒã˜å€¤ã§åŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°ã ã€‚ã€
é­”ç†æ²™ã€Œã¾ãšã€`Data.Array` ã® `all` é–¢æ•°ã«ã¤ã„ã¦ã€‚ã€

https://pursuit.purescript.org/packages/purescript-arrays/7.1.0/docs/Data.Array#v:all

```purs
all :: forall a. (a -> Boolean) -> Array a -> Boolean
```

```purs:ä¾‹
all (_ > 0) [] = True
all (_ > 0) [1, 2, 3] = True
all (_ > 0) [-1, -2, -3] = False
```
é­”ç†æ²™ã€Œã¾ãšç¬¬ä¸€å¼•æ•°ã«æ¡ä»¶å¼ã€ç¬¬äºŒå¼•æ•°ã«é…åˆ—ã‚’ã¨ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œä¾‹ã®ã‚ˆã†ã«ã€é…åˆ—ã®å€¤ã®ã™ã¹ã¦ãŒã€æ¡ä»¶å¼ã«å¯¾ã—ã¦ã€çœŸã«ãªã‚‹å ´åˆã¯`true`ã‚’è¿”ã™ã€‚ãã‚Œä»¥å¤–ã¯ã€`false`ã‚’è¿”ã™ãœã€‚ã€
é­”ç†æ²™ã€Œ`boardArr`ã¨ã„ã†ã®ã¯ã€ã€

```purs
[Just X, Just O, Nothing, Just X, Just O, Just O, Just X, Just O, Just O]
```

é­”ç†æ²™ã€Œã¿ãŸã„ãªå€¤ã ãªã€‚ã€
é­”ç†æ²™ã€Œ`line`ã¨ã„ã†ã®ã¯ã€`[ 0, 1, 2 ]` ã®ã‚ˆã†ãªå€¤ã ã€‚ã€
é­”ç†æ²™ã€Œã“ã‚Œã§ã€ã²ã¨ã¤ã®åˆ—ãŒã€3ã¤`X`ã§åŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ã€ãã‚Œã¨ã‚‚`O`ã§åŸ‹ã¾ã£ã¦ã„ã‚‹å ´åˆã¯ã€`true`ã‚’è¿”ã™ã€‚ã€
éœŠå¤¢ã€Œãªã‚‹ã»ã©ã­ã€‚ã€

```purs
-- | ã™ã¹ã¦ã® Line, SquareValueType ã®çµ„ã¿åˆã‚ã›ã«ã¤ã„ã¦ isLineMatch ã‚’è©•ä¾¡ã™ã‚‹
checked :: Array (Maybe SquareValueType)
checked = do
  line <- lines
  squareValue <- [ X, O ]
  pure
    if isLineMatch line squareValue then
      Just squareValue
    else
      Nothing
```

é­”ç†æ²™ã€Œã¤ãã®`checked`ã ã€‚ã€
é­”ç†æ²™ã€ŒArrayã¯ãƒ¢ãƒŠãƒ‰ãªã®ã§ã€doæ§‹æ–‡ãŒä½¿ãˆã‚‹ãªã€‚ã€
é­”ç†æ²™ã€Œ`line <- lines`ã€`squareValue <- [ X, O ]`ã‚ãŸã‚Šã¯ã€é…åˆ—ãªã®ã ãŒã€Haskellã®ãƒªã‚¹ãƒˆãƒ¢ãƒŠãƒ‰ã¨åŒã˜å‹•ãã‚’ã™ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œã¤ã¾ã‚Šã€`line`ã€`squareValue`ãŒå–ã‚Šå¾—ã‚‹å€¤ã«å¯¾ã—ã¦ã€ç·å½“ãŸã‚Šã§ã€å¾Œç¶šã®å‡¦ç†ã‚’è¡Œã†ã€‚ã€
é­”ç†æ²™ã€Œãã®ã‚ã¨ã¯ã€if å¼ã§ã€ã•ãã»ã©ã®`isLineMatch`ãŒçœŸãªã‚‰ã€ãã®å€¤`Just squareValue`ã‚’è¿”ã™ã€‚å½ãªã‚‰ã€`Nothing`ã‚’è¿”ã—ã¦ã„ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œdoæ§‹æ–‡ãªã®ã§ã€ãã‚Œã‚’`pure`ã§`Array`ã¨ã—ã¦è¿”ã—ã¦ã„ã‚‹ã¨ã„ã†æµã‚Œã ã€‚ã€

```purs
in
  -- | checked ã®ä¸­ã§ä¸€ç•ªæœ€åˆã« Just ãŒå‡ºã¦ããŸã‚‚ã®ã‚’è¿”ã™
  -- | find ã§å¸°ã£ã¦ãã‚‹ã®ã¯ Maybe (Maybe SquareValueType) ãªã®ã§ã€join ã§ä¸€ã¤ unwrap ã™ã‚‹
  join $ find isJust checked
```

é­”ç†æ²™ã€Œæ¬¡ã¯ã€`let-in` å¼ã®`in` ã®ãªã‹ã ã€‚ã€
é­”ç†æ²™ã€Œæœ€çµ‚çš„ãªè¿”ã‚Šå€¤ã ã€‚ã€
é­”ç†æ²™ã€Œã¾ãšã€`find` ã ã€‚ã“ã‚Œã¯ã€`Data.Array`ã®é–¢æ•°ã§ã€åå‰ã®é€šã‚Šã€æ¡ä»¶å¼ãŒçœŸã®ã‚‚ã®ã‚’é…åˆ—ã®ä¸­ã‹ã‚‰è¦‹ã¤ã‘ã‚‹ã¨ã„ã†é–¢æ•°ã ã€‚ã€

```purs
find :: forall a. (a -> Boolean) -> Array a -> Maybe a
```
```purs
find (contains $ Pattern "b") ["a", "bb", "b", "d"] = Just "bb"
find (contains $ Pattern "x") ["a", "bb", "b", "d"] = Nothing
```
https://pursuit.purescript.org/packages/purescript-arrays/7.1.0/docs/Data.Array#v:find

é­”ç†æ²™ã€Œç¬¬ä¸€å¼•æ•°ã«æ¡ä»¶å¼ã€ç¬¬äºŒå¼•æ•°ã«å¯¾è±¡ã®é…åˆ—ã‚’å–ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œæ¡ä»¶ã‚’æº€ãŸã™ã‚‚ã®ãŒã‚ã‚Œã°ã€`Just a`ã€ãªã‘ã‚Œã°`Nothing`ã‚’è¿”ã™ã€‚ã€
é­”ç†æ²™ã€Œã¤ãã«ã€`isJust`ã ãŒã€`Maybe`å‹ã®`Just`ã®å ´åˆãªã‚‰ã€`true`ã‚’è¿”ã™é–¢æ•°ã ãªã€‚ã€

https://pursuit.purescript.org/packages/purescript-maybe/6.0.0/docs/Data.Maybe#v:isJust

é­”ç†æ²™ã€Œã“ã‚Œã§ã€çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã‚ã‘ã ãŒã€ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚‚ã‚ã‚‹ã‚ˆã†ã«ã€findã¯ã€`Maybe a`ã‚’è¿”ã™ã€‚ã€
é­”ç†æ²™ã€Œã ã‹ã‚‰ã€`Maybe (Maybe SquareValueType)`ã®å€¤ãŒè¿”ã£ã¦ãã¦ã—ã¾ã†ã€‚ã€
é­”ç†æ²™ã€Œãã“ã§`join` é–¢æ•°ã®å‡ºç•ªã ã€‚ã€
é­”ç†æ²™ã€ŒäºŒé‡ã«ãªã£ã¦ã„ã‚‹ãƒ¢ãƒŠãƒ‰ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ä¸€é‡ã«ã§ãã‚‹ãœã€‚ã€

https://pursuit.purescript.org/packages/purescript-prelude/6.0.1/docs/Control.Bind#v:join

```purs
join :: forall a m. Bind m => m (m a) -> m a
```

é­”ç†æ²™ã€Œã¤ã¾ã‚Šã€`join $ find isJust checked` ã§ `Maybe SquareValueType` ã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ã‘ã ã€‚ã€

ã“ã‚Œã‚’PureScriptã®å¯¾è©±å‹PSCiã§è©¦ã—ã¦ã¿ã‚‹ãœã€‚

```
â¯ npx spago repl
PSCi, version 0.15.7
Type :? for help

import Prelude

> import Main
> import Data.Maybe
> calculateWinner1 $ map Just [X, O, X, X, O, O, X, O, O]
(Just X)
```

é­”ç†æ²™ã€Œã¨ã„ã†æ„Ÿã˜ã§æˆåŠŸã—ãŸã€‚ã€
é­”ç†æ²™ã€Œæ³¨æ„ç‚¹ã¨ã—ã¦ã¯ã€`calculateWinner1` ã¯ã€`Array (Maybe SquareValueType)` ã‚’å¼•æ•°ã«ã¨ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œã ã‹ã‚‰ã€`map Just â—â—`ã§ã€é…åˆ—ã‚’`Array (Maybe SquareValueType)`ã«å¤‰æ›ã™ã‚‹ã“ã¨ã ã€‚ã€

## ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¡ ãƒ‘ã‚¿ãƒ¼ãƒ³â‘  let-inå¼ ã§ guard
ã€‚
é­”ç†æ²™ã€Œä¸Šã§è§£èª¬ã—ãŸã€`calculateWinner1`ã ãŒã€ã“ã‚Œã¯ã‚‚ã£ã¨çŸ­ãæ›¸ã‘ã‚‹ã€‚ã€
é­”ç†æ²™ã€Œãã‚ŒãŒã€`calculateWinner2`ã ã€‚ã€

```purs
calculateWinner2 :: Board -> Maybe SquareValueType
calculateWinner2 boardArr =
  let
    -- | ã‚ã‚‹ Line ãŒåŒã˜ SquareValueType ã§åŸ‹ã¾ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹
    isLineMatch :: Array Int -> SquareValueType -> Boolean
    isLineMatch line squareValue = all (\i -> boardArr !! i == Just (Just squareValue)) line

    -- | ã™ã¹ã¦ã® Line, SquareValueType ã®çµ„ã¿åˆã‚ã›ã«ã¤ã„ã¦ isLineMatch ã‚’è©•ä¾¡ã™ã‚‹
    -- | false ãªã‚‰ãã‚Œã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
    checked :: Array SquareValueType
    checked = do
      line <- lines
      squareValue <- [ X, O ]
      guard $ isLineMatch line squareValue
      pure squareValue
  in
    head checked
```

é­”ç†æ²™ã€Œ`[]`ã¯ã€`Alternative` å‹ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã ã‹ã‚‰ã€`guard` ãŒä½¿ãˆã‚‹ã€‚ã€
é­”ç†æ²™ã€Œã“ã® `guard` æ¡ä»¶å¼ ã‚’ä½¿ãˆã°ã€æ¡ä»¶ã«å¯¾ã—ã¦ã€çœŸã§ãªã„å€¤ã‚’å–ã‚Šé™¤ã‘ã‚‹ãœã€‚ã€
é­”ç†æ²™ã€Œã“ã‚Œã‚’ã€`in` ã®ä¸­ã§é…åˆ—ã‹ã‚‰å€¤ã‚’å–ã‚Šå‡ºã›ã°ã€çµ‚ã‚ã‚Šã ã€‚`head` ã‚’ä½¿ãˆã°ã„ã„ãœã€‚ã€
é­”ç†æ²™ã€Œã¡ãªã¿ã«ã€PureScriptã® `Data.Array` ã®å‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ã€

```purs
head :: forall a. Array a -> Maybe a
```

https://pursuit.purescript.org/packages/purescript-arrays/4.0.1/docs/Data.Array#v:head

## ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¢ guard ã‚’æ´»ç”¨ã—ã¦ã€let-inå¼ã‚‚ãªãã™ã€‚

é­”ç†æ²™ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³â‘¢ã¯ã€`guard` ã‚’ä½¿ã†è·¯ç·šã‚’å¾¹åº•ã™ã‚‹ãœã€‚ã€
é­”ç†æ²™ã€Œãã‚Œã§ã€`let-in` å¼ã‚‚ãªããªã£ãŸã®ãŒã€æ¬¡ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã ãªã€‚ã€

```purs
calculateWinner :: Board -> Maybe SquareValueType
calculateWinner boardArr = head do
  line <- lines
  squareValue <- [ X, O ]
  guard $ all (\i -> boardArr !! i == Just (Just squareValue)) line
  pure squareValue
```

éœŠå¤¢ã€Œã‹ãªã‚ŠçŸ­ããªã£ãŸã‚ã­ã€‚ã€
é­”ç†æ²™ã€Œ`line`ã¨`squareValue`ã®ã™ã¹ã¦ã®å€¤ã‚’ã€`guard` ã§ãƒã‚§ãƒƒã‚¯ã—ã¦ã€åˆæ ¼ã—ãŸã€`squareValue`ã‚’è¿”ã™æ„Ÿã˜ã ã€‚ã€
é­”ç†æ²™ã€Œä»Šå›ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¢ã‚’ä½¿ãŠã†ã¨æ€ã†ã€‚ã€
éœŠå¤¢ã€Œãƒ¢ãƒŠãƒ‰ã¨ `Data.Array` ã®é–¢æ•°ã¯ã‹ãªã‚Šå¼·åŠ›ã­ã€‚ã€

â—†â—†â—†

é­”ç†æ²™ã€Œã¨ã„ã†ã‚ã‘ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è§£èª¬ã‚’ã—ã ã™ã¨é•·ããªã‚‹ã®ã§ä»Šæ—¥ã¯ã“ã“ã¾ã§ã¨ã™ã‚‹ãœã€‚ã€
éœŠå¤¢ã€Œã§ã¯ã€ã¾ãŸæ˜æ—¥ã€‚ã€

[^1]: è¥¿éƒ·ç”²çŸ¢äººã€èƒ½ç¾åä¸‰ã€åœè«–ã®é“æ¡ˆå†… ~çŸ¢å°ã§ãˆãŒãæ•°å­¦ã®ä¸–ç•Œ~ã€æŠ€è¡“è©•è«–ç¤¾ Kindleç‰ˆ ä½ç½®No.3983/4269
[^2]: ã€åœè«–ã®é“æ¡ˆå†… ~çŸ¢å°ã§ãˆãŒãæ•°å­¦ã®ä¸–ç•Œ~ã€ Kindleç‰ˆ ä½ç½®No.163/4269